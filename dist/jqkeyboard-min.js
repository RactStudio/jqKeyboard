/* jqKeyboard | v0.1.0 | https://github.com/hAWKdv/jqKeyboard#readme | MIT | b21 */
var jqKeyboard=function(t){"use strict";var a=10,e="normal",n="shift-b",i="special",s="jqk-btn",o="jqk-lang-btn",c="selected",r="jqk-hide",l="jq-keyboard",d="jqk-lang-cont",u="-lang",h=0,f=3,v={},p={},g={},C={};return g={insertCharacter:function(t,a,e){return t.slice(0,a.start)+e+t.slice(a.end)},backspaceStrManipulation:function(t,a,e){return 0===a.start&&0===a.end?t:t.slice(0,a.start-e)+t.slice(a.end)},setCaretPosition:function(t,a){var e;null!==t&&(t.createTextRange?(e=t.createTextRange(),e.move("character",a),e.select()):t.selectionStart?(t.focus(),t.setSelectionRange(a,a)):t.focus())}},v={createBase:function(){var a,e,n;this.$base=t("<div>").attr("id",l),this.$langCont=t("<div>").attr("id",d),this.$base.append(this.$langCont),this.createLayout(),t("body").append(this.$base),C.options&&C.options.containment?(a=t(C.options.containment),v.setBaseDefaultPos(a.width(),a.height())):(e=t(window).outerWidth()-this.$base.outerWidth(),n=t(window).outerHeight()-this.$base.outerHeight(),a=[h,h,e,n],this.maintainContainment()),this.$base.draggable({containment:a,cursor:"move"})},maintainContainment:function(){var a;t(window).resize(function(){clearTimeout(a),a=setTimeout(function(){var a=t(window).outerWidth()-v.$base.outerWidth(),e=t(window).outerHeight()-v.$base.outerHeight(),n=[h,h,a,e];v.$base.draggable("option","containment",n)},100)})},setBaseDefaultPos:function(t,e){this.$base.css({top:t-this.$base.outerWidth()-a,left:e-this.$base.outerHeight()-a})},createLayout:function(){var t,a,e,n=jqKeyboard.layouts.length;for(e=0;n>e&&f>e;e+=1)a=jqKeyboard.layouts[e],t=this.createButtons(a,e),this.createLangSwitchBtn(a.lang,e),this.$base.append(t)},createButtons:function(a,e){var n,i,s,o,c,l=t("<div>").addClass(a.lang+u);for(e>0&&l.addClass(r),o=0;o<a.layout.length;o+=1){for(n=t("<div>"),s=a.layout[o].split(" "),c=0;c<s.length;c+=1)i=this.buildButtonFromString(s[c]),n.append(i);l.append(n)}return l},buildButtonFromString:function(a){var i=t("<button>").addClass(s);return 1===a.length?i.addClass(e).data("val",a).html(a):3===a.length?i.addClass(n).data("val",a[0]).data("shift",a[2]).data("normal",a[0]).html(a[0]):-1!==a.indexOf("<<")&&-1!==a.indexOf(">>")&&(i=this.createSpecialBtn(i,a)),i},createLangSwitchBtn:function(a,e){var n=t("<button>").addClass(o).data("lang",a).html(a.toUpperCase());0===e&&(n.addClass(c),C.selectedLanguage=a),this.$langCont.append(n)},createSpecialBtn:function(t,a){var e=a.replace("<<","").replace(">>","");return t.addClass(i),"space"===e?t.data("val"," ").addClass("space"):t.addClass(e),t}},p={SHIFT_CLASS:"."+i+".shift",loadLanguageSwitcher:function(){t("."+o).click(function(){var a=t(this),e=a.data("lang");t("."+C.selectedLanguage+u).addClass(r),t("."+e+u).removeClass(r),t("."+o+"."+c).removeClass(c),a.addClass(c),C.selectedLanguage=e})},loadCapsLockEvent:function(){var a="."+i+".capslock",n="."+C.selectedLanguage+u;v.$base.find(n).find(a).click(function(){var a=t(this),i=a.closest(n),s=a.hasClass(c);s?a.removeClass(c):a.addClass(c),i.find("."+e).each(function(){var a=t(this),e=a.data("val");e=s?e.toUpperCase():e.toLowerCase(),a.html(e).data("val",e)})})},loadShiftEvent:function(){var a="."+C.selectedLanguage+u;v.$base.find(a).find(p.SHIFT_CLASS).click(function(){var i=t(this).closest(a);C.shift=!0,t(p.SHIFT_CLASS).addClass(c),i.find("."+e).each(function(){var a=t(this),e=a.data("val").toUpperCase();a.html(e).data("val",e)}),i.find("."+n).each(function(){var a=t(this),e=a.data("shift");a.html(e).data("val",e)})})},unshift:function(){var a="."+C.selectedLanguage+u,i=t(p.SHIFT_CLASS),s=i.closest(a);s.find("."+e).each(function(){var a=t(this),e=a.data("val").toLowerCase();a.html(e).data("val",e)}),s.find("."+n).each(function(){var a=t(this),e=a.data("normal");a.html(e).data("val",e)}),C.shift=!1,i.removeClass(c)},loadBackspaceEvent:function(){t("."+i+".backspace").click(function(){p.onDirectTextManip(function(t,a){var e;return e=t.start===t.end?1:0,{updatedContent:g.backspaceStrManipulation(a,t,e),caretOffset:-e}})})},loadInputButtonEvent:function(){v.$base.find("."+e).add("."+n).add("."+i+".space").click(function(){var a=t(this).data("val");p.onDirectTextManip(function(t,e){return{updatedContent:g.insertCharacter(e,t,a),caretOffset:1}}),p.unshift()})},onDirectTextManip:function(t){var a,e,n,i;p.$activeElement&&(p.resetActiveElementFocus(),e=p.$activeElement.val()||"",a=p.$activeElement[0],i={start:a.selectionStart,end:a.selectionEnd},n=t(i,e),p.$activeElement.val(n.updatedContent),g.setCaretPosition(a,i.start+n.caretOffset))},activeElementListener:function(){t("input, textarea").focus(function(){p.$activeElement=t(this)})},resetActiveElementFocus:function(){this.$activeElement.blur(function(){setTimeout(function(){p.$activeElement.focus(function(t){t.stopPropagation()})},25)})},loadEvents:function(){this.activeElementListener(),this.loadLanguageSwitcher(),this.loadInputButtonEvent(),this.loadBackspaceEvent(),this.loadCapsLockEvent(),this.loadShiftEvent()}},C={init:function(t){return jqKeyboard.layouts?(C.options=t,C.selectedLanguage=null,v.createBase(),void p.loadEvents()):void console.error("jqKeyboard: The keyboard layout configuration file hasn't been loaded.")}},{init:C.init}}(jQuery);
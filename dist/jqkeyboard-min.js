/* jqKeyboard | v0.1.0 | https://github.com/hAWKdv/jqKeyboard#readme | MIT | b51 */
var jqKeyboard=function(t){"use strict";var e=10,a="normal",n="shift-b",s="special",i="jqk-btn",o="jqk-lang-btn",c="selected",r="clicked",l="btn-row",d="jqk-hide",u="jq-keyboard",h="jqk-lang-cont",f="-lang",v=0,p=3,C={},g={},m={},L={},b={};return m={insertCharacter:function(t,e,a){return t.slice(0,e.start)+a+t.slice(e.end)},backspaceStrManipulation:function(t,e,a){return 0===e.start&&0===e.end?t:t.slice(0,e.start-a)+t.slice(e.end)},setCaretPosition:function(t,e){var a;null!==t&&(t.createTextRange?(a=t.createTextRange(),a.move("character",e),a.select()):t.selectionStart?(t.focus(),t.setSelectionRange(e,e)):t.focus())}},C={createBase:function(){var e,a;this.$base=t("<div>").attr("id",u),this.$langCont=t("<div>").attr("id",h),this.$base.append(this.$langCont),this.createLayout(),t("body").append(this.$base),b.options&&b.options.containment?(this.containment=t(b.options.containment),this.setBaseDefaultPos(containment.width(),this.containment.height())):(e=t(window).outerWidth()-this.$base.outerWidth(),a=t(window).outerHeight()-this.$base.outerHeight(),this.containment=[v,v,e,a],this.maintainContainment())},maintainContainment:function(){var e;t(window).resize(function(){clearTimeout(e),e=setTimeout(function(){var e=t(window).outerWidth()-C.$base.outerWidth(),a=t(window).outerHeight()-C.$base.outerHeight(),n=[v,v,e,a];C.$base.draggable("option","containment",n)},100)})},setBaseDefaultPos:function(t,a){this.$base.css({top:t-this.$base.outerWidth()-e,left:a-this.$base.outerHeight()-e})},createLayout:function(){var t,e,a,n=jqKeyboard.layouts.length;for(a=0;n>a&&p>a;a+=1)e=jqKeyboard.layouts[a],t=this.createButtons(e,a),this.createLangSwitchBtn(e.lang,a),this.$base.append(t)},createButtons:function(e,a){var n,s,i,o,c,r=t("<div>").addClass(e.lang+f);for(a>0&&r.addClass(d),o=0;o<e.layout.length;o+=1){for(n=t("<div>").addClass(l),i=e.layout[o].split(" "),c=0;c<i.length;c+=1)s=this.buildButtonFromString(i[c]),n.append(s);r.append(n)}return r},buildButtonFromString:function(e){var s=t("<button>").addClass(i);return 1===e.length?s.addClass(a).data("val",e).html(e):3===e.length?s.addClass(n).data("val",e[0]).data("shift",e[2]).data("normal",e[0]).html(e[0]):-1!==e.indexOf("<<")&&-1!==e.indexOf(">>")&&(s=this.createSpecialBtn(s,e)),s},createSpecialBtn:function(t,e){var a=e.replace("<<","").replace(">>","");switch(a){case"space":t.data("val"," ");break;case"tab":t.data("val","	");break;case"enter":t.data("val","\n")}return t.addClass(s+" "+a),t},createLangSwitchBtn:function(e,a){var n=t("<button>").addClass(o).data("lang",e).html(e.toUpperCase());0===a&&(n.addClass(c),b.selectedLanguage=e),this.$langCont.append(n)}},g={SHIFT_CLASS:"."+s+".shift",CPSLCK_CLASS:"."+s+".capslock",loadLanguageSwitcher:function(){t("."+o).click(function(){var e=t(this),a=e.data("lang"),n="."+a+f,s=g.getSelectedLngClass();s!==n&&(t(s).addClass(d),t(n).removeClass(d),t("."+o+"."+c).removeClass(c),e.addClass(c),b.selectedLanguage=a)})},getSelectedLngClass:function(){return"."+b.selectedLanguage+f},loadCapsLockEvent:function(){var e=this.getSelectedLngClass();this.onLocalButtonClick(g.CPSLCK_CLASS,function(){var a,n;b.shift||(a=t(this),n=a.closest(e),b.capsLock?(a.removeClass(c),b.capsLock=!1):(a.addClass(c),b.capsLock=!0),g.traverseLetterButtons(n,b.capsLock))})},loadShiftEvent:function(){var e=this.getSelectedLngClass();this.onLocalButtonClick(g.SHIFT_CLASS,function(){var a;return b.shift?void g.unshift():(b.capsLock&&(t(g.CPSLCK_CLASS).removeClass(c),b.capsLock=!1),a=t(this).closest(e),g.traverseInputButtons(a,!0,"shift"),b.shift=!0,void t(g.SHIFT_CLASS).addClass(c))})},unshift:function(){var e=this.getSelectedLngClass(),a=t(g.SHIFT_CLASS),n=a.closest(e);this.traverseInputButtons(n,!1,"normal"),b.shift=!1,a.removeClass(c)},onLocalButtonClick:function(t,e){C.$base.find(this.getSelectedLngClass()).find(t).click(e)},traverseLetterButtons:function(e,n){e.find("."+a).each(function(){var e=t(this),a=e.data("val");a=n?a.toUpperCase():a.toLowerCase(),e.html(a).data("val",a)})},traverseInputButtons:function(e,a,s){this.traverseLetterButtons(e,a),e.find("."+n).each(function(){var e=t(this),a=e.data(s);e.html(a).data("val",a)})},loadBackspaceEvent:function(){t("."+s+".backspace").click(function(){g.onDirectTextManip(function(t,e){var a;return a=t.start===t.end?1:0,{updatedContent:m.backspaceStrManipulation(e,t,a),caretOffset:-a}})})},loadInputButtonEvent:function(){C.$base.find("."+a).add("."+n).add("."+s+".space").add("."+s+".tab").add("."+s+".enter").click(function(){var e=t(this).data("val");g.onDirectTextManip(function(t,a){return{updatedContent:m.insertCharacter(a,t,e),caretOffset:1}}),b.shift&&g.unshift()})},onDirectTextManip:function(t){var e,a,n,s;g.$activeElement&&(g.resetActiveElementFocus(),a=g.$activeElement.val()||"",e=g.$activeElement[0],s={start:e.selectionStart,end:e.selectionEnd},n=t(s,a),g.$activeElement.val(n.updatedContent),m.setCaretPosition(e,s.start+n.caretOffset))},activeElementListener:function(){t("input, textarea").focus(function(){g.$activeElement=t(this)})},resetActiveElementFocus:function(){this.$activeElement.blur(function(){setTimeout(function(){g.$activeElement.focus(function(t){t.stopPropagation()})},25)})},loadEvents:function(){this.activeElementListener(),this.loadLanguageSwitcher(),this.loadInputButtonEvent(),this.loadBackspaceEvent(),this.loadCapsLockEvent(),this.loadShiftEvent()}},L={attachDragToBase:function(){C.$base.draggable({containment:C.containment,cursor:"move"})},attachOnClickBtnEvent:function(){t("."+i).mousedown(function(){t(this).addClass(r)}).mouseup(function(){t(this).removeClass(r)})},load:function(){this.attachDragToBase(),this.attachOnClickBtnEvent()}},b={init:function(t){return jqKeyboard.layouts?(b.options=t,b.selectedLanguage=null,b.shift=!1,b.capsLock=!1,C.createBase(),g.loadEvents(),void L.load()):void console.error("jqKeyboard: The keyboard layout configuration file hasn't been loaded.")}},{init:b.init}}(jQuery);
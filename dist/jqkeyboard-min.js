/* jqKeyboard | v0.1.0 | https://github.com/hAWKdv/jqKeyboard#readme | MIT | b41 */
var jqKeyboard=function(t){"use strict";var e=10,a="normal",n="shift-b",s="special",i="jqk-btn",o="jqk-lang-btn",c="selected",r="jqk-hide",l="jq-keyboard",d="jqk-lang-cont",u="-lang",h=0,f=3,v={},p={},g={},C={};return g={insertCharacter:function(t,e,a){return t.slice(0,e.start)+a+t.slice(e.end)},backspaceStrManipulation:function(t,e,a){return 0===e.start&&0===e.end?t:t.slice(0,e.start-a)+t.slice(e.end)},setCaretPosition:function(t,e){var a;null!==t&&(t.createTextRange?(a=t.createTextRange(),a.move("character",e),a.select()):t.selectionStart?(t.focus(),t.setSelectionRange(e,e)):t.focus())}},v={createBase:function(){var e,a,n;this.$base=t("<div>").attr("id",l),this.$langCont=t("<div>").attr("id",d),this.$base.append(this.$langCont),this.createLayout(),t("body").append(this.$base),C.options&&C.options.containment?(e=t(C.options.containment),v.setBaseDefaultPos(e.width(),e.height())):(a=t(window).outerWidth()-this.$base.outerWidth(),n=t(window).outerHeight()-this.$base.outerHeight(),e=[h,h,a,n],this.maintainContainment()),this.$base.draggable({containment:e,cursor:"move"})},maintainContainment:function(){var e;t(window).resize(function(){clearTimeout(e),e=setTimeout(function(){var e=t(window).outerWidth()-v.$base.outerWidth(),a=t(window).outerHeight()-v.$base.outerHeight(),n=[h,h,e,a];v.$base.draggable("option","containment",n)},100)})},setBaseDefaultPos:function(t,a){this.$base.css({top:t-this.$base.outerWidth()-e,left:a-this.$base.outerHeight()-e})},createLayout:function(){var t,e,a,n=jqKeyboard.layouts.length;for(a=0;n>a&&f>a;a+=1)e=jqKeyboard.layouts[a],t=this.createButtons(e,a),this.createLangSwitchBtn(e.lang,a),this.$base.append(t)},createButtons:function(e,a){var n,s,i,o,c,l=t("<div>").addClass(e.lang+u);for(a>0&&l.addClass(r),o=0;o<e.layout.length;o+=1){for(n=t("<div>"),i=e.layout[o].split(" "),c=0;c<i.length;c+=1)s=this.buildButtonFromString(i[c]),n.append(s);l.append(n)}return l},buildButtonFromString:function(e){var s=t("<button>").addClass(i);return 1===e.length?s.addClass(a).data("val",e).html(e):3===e.length?s.addClass(n).data("val",e[0]).data("shift",e[2]).data("normal",e[0]).html(e[0]):-1!==e.indexOf("<<")&&-1!==e.indexOf(">>")&&(s=this.createSpecialBtn(s,e)),s},createSpecialBtn:function(t,e){var a=e.replace("<<","").replace(">>","");switch(a){case"space":t.data("val"," ");break;case"tab":t.data("val","	");break;case"enter":t.data("val","\n")}return t.addClass(s+" "+a),t},createLangSwitchBtn:function(e,a){var n=t("<button>").addClass(o).data("lang",e).html(e.toUpperCase());0===a&&(n.addClass(c),C.selectedLanguage=e),this.$langCont.append(n)}},p={SHIFT_CLASS:"."+s+".shift",CPSLCK_CLASS:"."+s+".capslock",loadLanguageSwitcher:function(){t("."+o).click(function(){var e=t(this),a=e.data("lang"),n="."+a+u,s=p.getSelectedLngClass();s!==n&&(t(s).addClass(r),t(n).removeClass(r),t("."+o+"."+c).removeClass(c),e.addClass(c),C.selectedLanguage=a)})},getSelectedLngClass:function(){return"."+C.selectedLanguage+u},loadCapsLockEvent:function(){var e=this.getSelectedLngClass();this.onLocalButtonClick(p.CPSLCK_CLASS,function(){var a,n;C.shift||(a=t(this),n=a.closest(e),C.capsLock?(a.removeClass(c),C.capsLock=!1):(a.addClass(c),C.capsLock=!0),p.traverseLetterButtons(n,C.capsLock))})},loadShiftEvent:function(){var e=this.getSelectedLngClass();this.onLocalButtonClick(p.SHIFT_CLASS,function(){var a;return C.shift?void p.unshift():(C.capsLock&&(t(p.CPSLCK_CLASS).removeClass(c),C.capsLock=!1),a=t(this).closest(e),p.traverseInputButtons(a,!0,"shift"),C.shift=!0,void t(p.SHIFT_CLASS).addClass(c))})},unshift:function(){var e=this.getSelectedLngClass(),a=t(p.SHIFT_CLASS),n=a.closest(e);this.traverseInputButtons(n,!1,"normal"),C.shift=!1,a.removeClass(c)},onLocalButtonClick:function(t,e){v.$base.find(this.getSelectedLngClass()).find(t).click(e)},traverseLetterButtons:function(e,n){e.find("."+a).each(function(){var e=t(this),a=e.data("val");a=n?a.toUpperCase():a.toLowerCase(),e.html(a).data("val",a)})},traverseInputButtons:function(e,a,s){this.traverseLetterButtons(e,a),e.find("."+n).each(function(){var e=t(this),a=e.data(s);e.html(a).data("val",a)})},loadBackspaceEvent:function(){t("."+s+".backspace").click(function(){p.onDirectTextManip(function(t,e){var a;return a=t.start===t.end?1:0,{updatedContent:g.backspaceStrManipulation(e,t,a),caretOffset:-a}})})},loadInputButtonEvent:function(){v.$base.find("."+a).add("."+n).add("."+s+".space").add("."+s+".tab").add("."+s+".enter").click(function(){var e=t(this).data("val");p.onDirectTextManip(function(t,a){return{updatedContent:g.insertCharacter(a,t,e),caretOffset:1}}),C.shift&&p.unshift()})},onDirectTextManip:function(t){var e,a,n,s;p.$activeElement&&(p.resetActiveElementFocus(),a=p.$activeElement.val()||"",e=p.$activeElement[0],s={start:e.selectionStart,end:e.selectionEnd},n=t(s,a),p.$activeElement.val(n.updatedContent),g.setCaretPosition(e,s.start+n.caretOffset))},activeElementListener:function(){t("input, textarea").focus(function(){p.$activeElement=t(this)})},resetActiveElementFocus:function(){this.$activeElement.blur(function(){setTimeout(function(){p.$activeElement.focus(function(t){t.stopPropagation()})},25)})},loadEvents:function(){this.activeElementListener(),this.loadLanguageSwitcher(),this.loadInputButtonEvent(),this.loadBackspaceEvent(),this.loadCapsLockEvent(),this.loadShiftEvent()}},C={init:function(t){return jqKeyboard.layouts?(C.options=t,C.selectedLanguage=null,C.shift=!1,C.capsLock=!1,v.createBase(),void p.loadEvents()):void console.error("jqKeyboard: The keyboard layout configuration file hasn't been loaded.")}},{init:C.init}}(jQuery);